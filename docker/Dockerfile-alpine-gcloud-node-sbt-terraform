FROM python:3.6-alpine

RUN apk update && apk upgrade && \
    apk add --no-cache bash docker git git-lfs openssh

RUN apk --no-cache add --repository http://dl-cdn.alpinelinux.org/alpine/edge/testing sbt
# https://github.com/sgerrand/alpine-pkg-glibc/issues/1
RUN apk --no-cache --allow-untrusted -X https://apkproxy.herokuapp.com/sgerrand/alpine-pkg-glibc add glibc glibc-bin
RUN apk --no-cache add openjdk8
ENV PATH $PATH:/usr/lib/jvm/java-1.8-openjdk/bin

RUN apk --no-cache add nodejs nodejs-npm
RUN npm install -g typescript
ENV NODE_PATH $NODE_PATH:/usr/lib/node_modules

# install gcloud sdk on alpine
RUN wget https://dl.google.com/dl/cloudsdk/channels/rapid/google-cloud-sdk.zip
RUN unzip google-cloud-sdk.zip && rm google-cloud-sdk.zip
RUN google-cloud-sdk/install.sh --additional-components kubectl
ENV PATH $PATH:/google-cloud-sdk/bin

RUN gcloud --version
RUN gcloud auth configure-docker -q

RUN apk --no-cache add terraform

ADD . /code/servicer/
RUN pip install -e /code/servicer
